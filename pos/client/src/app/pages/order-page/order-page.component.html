<app-navbar [user]="user"></app-navbar>
<h2 class="px-2">Order Management</h2>
<div class="order-page-container p-2">
    <div class="full-menu-container">
      <!-- class="menu-item" -->

      <!-- This would work, but menu-items-container is set as flex which is causing a issue -->
      
      <nz-tabset 
        nzCentered
        [nzTabBarGutter]="60"
        [nzAnimated]="false"
        (nzSelectedIndexChange)="handleTimeTabChange($event)"
      >

      <nz-tab nzTitle="All Items">

        <div class="menu-items-container">
          @if (menuList) {
            @for (item of menuList.items; track $index) {
              <div class="item-block my-4 mx-4 text-center rounded-md" (click)="addToCart(item)">
                <img src="../../../assets/item-images/burger-1.jpg" alt="food image" style="width: 60%; height: 60%; object-fit: cover;" class="rounded-md">
                <p><strong>{{item.item.itemName}}</strong></p>
                <p>${{item.item.itemPrice}}</p>
              </div>
            }
          }
        </div>

      </nz-tab>
        <nz-tab *ngFor="let time of timeOfDays" [nzTitle]="time">
          <nz-tabset 
            nzCentered 
            [nzTabBarGutter]="60"
            (nzSelectedIndexChange)="handleCategoryTabChange($event)"
            [nzSelectedIndex]="getTimeOutDayIndex()"
            
          >
            <nz-tab *ngFor="let category of categories" [nzTitle]="category.name">
              <div class="menu-items-container">
                @if (filteredMenu) {
                  @for (item of filteredMenu; track $index) {
                    <div class="item-block my-4 mx-4 text-center rounded-md" (click)="addToCart(item)">
                      <img src="../../../assets/item-images/burger-1.jpg" alt="food image" style="width: 60%; height: 60%; object-fit: cover;" class="rounded-md">
                      <p><strong>{{item.item.itemName}}</strong></p>
                      <p>${{item.item.itemPrice}}</p>
                    </div>
                  }
                }
                @if (!filteredMenu && menuList) {
                  @for (item of menuList.items; track $index) {
                    <div class="item-block my-4 mx-4 text-center rounded-md" (click)="addToCart(item)">
                      <img src="../../../assets/item-images/burger-1.jpg" alt="food image" style="width: 60%; height: 60%; object-fit: cover;" class="rounded-md">
                      <p><strong>{{item.item.itemName}}</strong></p>
                      <p>${{item.item.itemPrice}}</p>
                    </div>
                  }
                }
              </div>
            </nz-tab>
          </nz-tabset>
        </nz-tab>
      </nz-tabset>
      <ng-template #clearTemplate>
        <!-- <button nz-button (click)="clearTabs()">Clear</button> -->
      </ng-template>
    </div>

    <div class="order-cart-container">
      <h3 class="px-2 pt-2">Order Summary</h3>
      <!-- <div class="order-items-container"> -->
      @for (cartItem of orderCart; track $index) {
        <div class="order-items-container mr-2">
          <div class="pt-1"><strong>{{cartItem.item.itemName}}</strong></div>
          <div class="pt-1">${{cartItem.item.itemPrice}}</div>
          <button nz-button nzShape="circle" (click)="editCartItem(cartItem)">
            <span nz-icon nzType="edit" nzTheme="outline"></span>
          </button>
          <button nz-button nzShape="circle" (click)="removeItemFromCart(cartItem)">
            <span nz-icon nzType="close" nzTheme="outline"></span>
          </button>
        </div>
      }
      <h3 class="pt-12">Total: {{ calculateTotal() }}</h3>

      <button nz-button (click)="confirmAndSendOrder()">Send Order</button>
    </div>
</div>

<!--  Drawer for Order Customization -->
<nz-drawer *ngIf="selectedCartItem"
      [nzBodyStyle]="{ overflow: 'auto' }"
      [nzMaskClosable]="false"
      [nzWidth]="720"
      [nzVisible]="editorVisible"
      nzTitle="Item Customization"
      [nzFooter]="footerTpl"
      (nzOnClose)="cancelEdit(); closeEditor()"
    >
    <ng-container *nzDrawerContent>
      <nz-descriptions [nzColumn]="2" nzTitle="Item Info">
        <nz-descriptions-item nzTitle="Item Name" [nzSpan]="1">{{ selectedCartItem.item.itemName }}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Id" [nzSpan]="1">{{ selectedCartItem.item.itemId}}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Price" [nzSpan]="1">${{ selectedCartItem.item.itemPrice }}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Portion Size" [nzSpan]="1">{{ selectedCartItem.item.itemPortionSize }}</nz-descriptions-item>
      </nz-descriptions>
      <nz-divider></nz-divider>
      <form>
        <div nz-col nzSpan="14">
          <nz-form-item>
            <nz-form-label><h3>Quantity</h3></nz-form-label>
            <nz-form-control>
              <nz-input-number
                name="seats"
                  type="number"
                  id="seats"
                  [(ngModel)]="selectedCartItem.item.itemQuantity"
                  [nzMin]="1"
               />
            </nz-form-control>
          </nz-form-item>
        </div>
      </form>
      <h3>Customize Add-ons</h3>
      <button nz-button class="px-16" style="margin-right: 8px;" (click)="selectAddNoOtion('Add')">Add</button>
      <button nz-button class="px-16" style="margin-right: 8px;" (click)="selectAddNoOtion('No')">No</button>
      
      <div>
        @if (selectedOption === 'Add') {
          @for(option of selectedCartItem.item.options.add; track $index) {
            <button nz-button class="px-12 py-8 my-4 text-align" style="margin-right: 8px;" (click)="insertToAddOption(option)">{{option.ingredientName}}</button>
          }
        } 
        @if (selectedOption === 'No') {
          @for(option of selectedCartItem.item.options.no; track $index) {
            <button nz-button class="px-12 py-8 my-4 text-align" style="margin-right: 8px;" (click)="insertToNoOption(option)">{{option.ingredientName}}</button>
          }
        }
      </div>

      <h3 class="mt-4">Optional Notes</h3>
      <input nz-input placeholder="Add notes here" [(ngModel)]="optionalNotes" type="string" />
      <button nz-button class="px-16" style="margin-right: 8px;" (click)="insertOptionalNotes()">Save Note</button>
    </ng-container>


    <ng-template #footerTpl>
      <div style="float: right">
        <button nz-button style="margin-right: 8px;" (click)="closeEditor()">Cancel</button>
        <button nz-button nzType="primary" (click)="closeEditor()">Save</button>
      </div>
    </ng-template>
  </nz-drawer>

<!-- <div class="item-block my-4 mx-4 text-center rounded-md" (click)="addToCart(item)">
  <img src="../../../assets/item-images/burger-1.jpg" alt="food image" style="width: 60%; height: 60%; object-fit: cover;" class="rounded-md">
  <p><strong>{{cartItem.item.itemName}}</strong></p>
  <p>${{cartItem.item.itemPrice}}</p>
</div> -->



<!-- <h3 class="px-2 pt-2">Order Summary</h3>
<ul>
  @for (cartItem of orderCart; track $index) {
    <li>
      {{ cartItem.item.itemName }} - {{ cartItem.item.itemPrice }}
    </li>
  }
</ul>
-->

